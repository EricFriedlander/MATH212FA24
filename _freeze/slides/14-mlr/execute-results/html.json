{
  "hash": "8b91b58083e06d1235f19f97f9c58224",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Multiple linear regression (MLR)\"\nauthor: \"Prof. Eric Friedlander\"\ndate: \"2024-09-30\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[ðŸ”— MAT 212 - Fall 2024 -  Schedule](https://mat212fa24.netlify.app/schedule)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    multiplex: false\n    transition: fade\n    slide-number: false\n    incremental: false \n    chalkboard: true\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\n  cache: false\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n## Trying something new {.smaller}\n\n-   Open but do not start AE-10 \n-   Notify Dr. F when you're ready to proceed\n-   The goal is to integrate the activity into the lecture (keep track of how you like this approach and give Dr. F feedback at the end of class)\n-   While you're waiting feel free to start on Exercise 0\n\n::: appex\nðŸ“‹ [AE 10 - Credit Cards](https://mat212fa24.netlify.app/ae/ae-10-mlr)\n:::\n\n## Computational setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(mosaic)\nlibrary(ISLR2)\nlibrary(patchwork)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(scales)\n\n# set default theme and larger font size for ggplot2\nggplot2::theme_set(ggplot2::theme_minimal(base_size = 16))\n```\n:::\n\n\n# Considering multiple variables\n\n## Data: Credit Cards\n\nThe data is from the `Credit` data set in the **ISLR2** R package. It is a simulated data set of 400 credit card customers.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 400\nColumns: 11\n$ Income    <dbl> 14.891, 106.025, 104.593, 148.924, 55.882, 80.180, 20.996, 7â€¦\n$ Limit     <dbl> 3606, 6645, 7075, 9504, 4897, 8047, 3388, 7114, 3300, 6819, â€¦\n$ Rating    <dbl> 283, 483, 514, 681, 357, 569, 259, 512, 266, 491, 589, 138, â€¦\n$ Cards     <dbl> 2, 3, 4, 3, 2, 4, 2, 2, 5, 3, 4, 3, 1, 1, 2, 3, 3, 3, 1, 2, â€¦\n$ Age       <dbl> 34, 82, 71, 36, 68, 77, 37, 87, 66, 41, 30, 64, 57, 49, 75, â€¦\n$ Education <dbl> 11, 15, 11, 11, 16, 10, 12, 9, 13, 19, 14, 16, 7, 9, 13, 15,â€¦\n$ Own       <fct> No, Yes, No, Yes, No, No, Yes, No, Yes, Yes, No, No, Yes, Noâ€¦\n$ Student   <fct> No, Yes, No, No, No, No, No, No, No, Yes, No, No, No, No, Noâ€¦\n$ Married   <fct> Yes, Yes, No, No, Yes, No, No, No, No, Yes, Yes, No, Yes, Yeâ€¦\n$ Region    <fct> South, West, West, West, South, South, East, West, South, Eaâ€¦\n$ Balance   <dbl> 333, 903, 580, 964, 331, 1151, 203, 872, 279, 1350, 1407, 0,â€¦\n```\n\n\n:::\n:::\n\n\n## Variables\n\n**Features (another name for predictors)**\n\n-   `Income`: Annual income (in 1000's of US dollars)\n-   `Rating`: Credit Rating\n\n**Outcome**\n\n-   `Limit`: Credit limit\n\n::: appex\nComplete Exercises 0-1. Please don't look ahead in the slides.\n:::\n\n## Outcome: `Limit`\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nCredit |> \n  gf_density(~Limit, fill = \"steelblue\") |> \n  gf_labs(title = \"Distribution of credit limit\",\n          x = \"Credit Limit\")|> \n  gf_refine(scale_x_continuous(labels = dollar_format()))\n```\n\n::: {.cell-output-display}\n![](14-mlr_files/figure-revealjs/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"font-size: 24px; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> min </th>\n   <th style=\"text-align:right;\"> Q1 </th>\n   <th style=\"text-align:right;\"> median </th>\n   <th style=\"text-align:right;\"> Q3 </th>\n   <th style=\"text-align:right;\"> max </th>\n   <th style=\"text-align:right;\"> mean </th>\n   <th style=\"text-align:right;\"> sd </th>\n   <th style=\"text-align:right;\"> n </th>\n   <th style=\"text-align:right;\"> missing </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:right;\"> 855 </td>\n   <td style=\"text-align:right;\"> 3088 </td>\n   <td style=\"text-align:right;\"> 4622.5 </td>\n   <td style=\"text-align:right;\"> 5872.75 </td>\n   <td style=\"text-align:right;\"> 13913 </td>\n   <td style=\"text-align:right;\"> 4735.6 </td>\n   <td style=\"text-align:right;\"> 2308.199 </td>\n   <td style=\"text-align:right;\"> 400 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Predictors {.small}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\np1 <- Credit |> \n  gf_density(~Limit, fill = \"steelblue\") |> \n  gf_labs(title = \"Distribution of credit limit\",\n          x = \"Credit Limit\")|> \n    gf_refine(scale_x_continuous(labels = dollar_format()))\n\np2 <- Credit |> \n  gf_histogram(~Rating, binwidth = 50) |> \n  gf_labs(title = \"\",\n       x = \"Credit Rating\")\n\np3 <- Credit |> \n  gf_histogram(~Income, binwidth = 10) |> \n  gf_labs(title = \"\",\n       x = \"Annual income (in $1,000s)\") |> \n  gf_refine(scale_x_continuous(labels = dollar_format()))\n\np1 / (p2 + p3)\n```\n\n::: {.cell-output-display}\n![](14-mlr_files/figure-revealjs/unnamed-chunk-4-1.png){width=100%}\n:::\n:::\n\n\n## Outcome vs. predictors {.small}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\np4 <- Credit |> \n  gf_point(Limit ~ Rating, color = \"steelblue\") |> \n  gf_labs(\n    y = \"Credit Limit\",\n    x = \"Credit Rating\"\n  ) |> \n  gf_refine(scale_y_continuous(labels = dollar_format()))\n\n\np5 <- Credit |> \n  gf_point(Limit ~ Income, color = \"steelblue\") |> \n  gf_labs(\n    y = \"Credit Limit\",\n    x = \"Annual income (in $1,000s)\"\n  ) |> \n  gf_refine(scale_x_continuous(labels = dollar_format()),\n                               scale_y_continuous(labels = percent_format(scale = 1)))\n\np4 / p5\n```\n\n::: {.cell-output-display}\n![](14-mlr_files/figure-revealjs/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n## Single vs. multiple predictors\n\nSo far we've used a *single predictor variable* to understand variation in a quantitative response variable\n\n. . .\n\nNow we want to use *multiple predictor variables* to understand variation in a quantitative response variable\n\n# Multiple linear regression\n\n## Multiple linear regression (MLR) {.smaller}\n\nBased on the analysis goals, we will use a **multiple linear regression** model of the following form\n\n$$\n\\begin{aligned}\\hat{\\text{Limit}} ~ = \n\\hat{\\beta}_0 & + \\hat{\\beta}_1 \\text{Rating} + \\hat{\\beta}_2 \\text{Income}\n\\end{aligned}\n$$\n\nSimilar to simple linear regression, this model assumes that at each combination of the predictor variables, the values `Limit` follow a Normal distribution.\n\n## Multiple linear regression\n\n**Recall:** The simple linear regression model assumes\n\n$$\nY|X\\sim N(\\beta_0 + \\beta_1 X, \\sigma_{\\epsilon}^2)\n$$\n\n. . .\n\n**Similarly:** The multiple linear regression model assumes\n\n$$\nY|X_1, X_2, \\ldots, X_p \\sim N(\\beta_0 + \\beta_1 X_1 + \\beta_2 X_2 + \\dots + \\beta_p X_p, \\sigma_{\\epsilon}^2)\n$$\n\n## Multiple linear regression\n\nAt any combination of the predictors, the mean value of the response $Y$, is\n\n$$\n\\mu_{Y|X_1, \\ldots, X_p} = \\beta_0 + \\beta_1 X_{1} + \\beta_2 X_2 + \\dots + \\beta_p X_p\n$$\n\n. . .\n\nUsing multiple linear regression, we can estimate the mean response for any combination of predictors\n\n$$\n\\hat{Y} = \\hat{\\beta}_0 + \\hat{\\beta}_1 X_{1} + \\hat{\\beta}_2 X_2 + \\dots + \\hat{\\beta}_p X_{p}\n$$\n\n\n# Model fit\n\n::: appex\nComplete exercises 2-4 in the application exercise. Don't look ahead! \n:::\n\n## Model fit\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|term        | estimate| std.error| statistic| p.value|\n|:-----------|--------:|---------:|---------:|-------:|\n|(Intercept) | -532.471|    24.173|   -22.028|   0.000|\n|Rating      |   14.771|     0.096|   153.124|   0.000|\n|Income      |    0.557|     0.423|     1.316|   0.189|\n\n\n:::\n:::\n\n\n## Model equation\n\n$$\n\\begin{align}\\hat{\\text{Limit}} =  -532.471 &+14.771 \\times \\text{Rating}\\\\\n& -0.557 \\times \\text{Income}\n\\end{align}\n$$\n\n## Interpreting $\\hat{\\beta}_j$\n\n-   The estimated coefficient $\\hat{\\beta}_j$ is the expected change in the mean of $y$ when $x_j$ increases by one unit, *holding the values of all other predictor variables constant*.\n\n. . .\n\n::: appex\nComplete Exercises 5-6.\n:::\n\n## Prediction\n\n::: question\nWhat is the predicted credit limit for an borrower with an credit rating of ratio of 700, and who has an annual income of \\$59,000?\n:::\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\n-532.471 + 14.771 * 700 + - .577 * 59\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 9773.186\n```\n\n\n:::\n:::\n\n\n. . .\n\nThe predicted credit limit for an borrower with an credit rating of ratio of 700, and who has an annual income of \\$59,000 is \\$9773.19.\n\n## Prediction, revisited {.midi}\n\nJust like with simple linear regression, we can use the `predict` function in R to calculate the appropriate intervals for our predicted values:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n       fit      lwr      upr\n1 9840.213 9476.983 10203.44\n```\n\n\n:::\n:::\n\n\n::: callout-note\nDifference in predicted value due to rounding the coefficients on the previous slide.\n:::\n\n## Prediction interval for $\\hat{y}$\n\n::: question\nCalculate a 90% confidence interval for the **predicted credit limit** for an individual borrower an credit rating of ratio of 700, and who has an annual income of \\$59,000?\n:::\n\n<br>\n\n\n::: {.cell}\n\n```{.r .cell-code}\npredict(lim_fit, new_borrower, interval = \"prediction\", level = 0.90)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       fit      lwr      upr\n1 9840.213 9535.599 10144.83\n```\n\n\n:::\n:::\n\n\n::: question\nWhen would you use `\"confidence\"`? Would the interval be wider or narrower?\n:::\n\n## Cautions\n\n-   **Do not extrapolate!** Because there are multiple predictor variables, there is the potential to extrapolate in many directions\n-   The multiple regression model only shows **association, not causality**\n    -   To show causality, you must have a carefully designed experiment or carefully account for confounding variables in an observational study\n    \n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}