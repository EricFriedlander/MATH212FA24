{
  "hash": "bc16e5e583cc1dc247fba88c24f745d5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"SLR: Model evaluation\"\nauthor: \"Prof. Eric Friedlander\"\ndate: \"2024-09-18\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[üîó MAT 212 - Fall 2024 -  Schedule](https://mat212fa24.netlify.app/schedule)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    multiplex: false\n    transition: fade\n    slide-number: false\n    incremental: false \n    chalkboard: true\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nexecute:\n  freeze: auto\n  echo: true\n  cache: false\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n\n\n\n# Questions from last class?\n\n# Model conditions\n\n## Model conditions\n\n1.  **Linearity:** There is a linear relationship between the outcome and predictor variables\n2.  **Constant variance:** The variability of the errors is equal for all values of the predictor variable\n3.  **Normality:** The errors follow a normal distribution\n4.  **Independence:** The errors are independent from each other\n\n## Warm-Up: Comparing inferential methods\n\n::: question\n-   What are the advantages of using simulation-based inference methods? What are the advantages of using inference methods based on mathematical models?\n\n-   Under what scenario(s) would you prefer to use simulation-based methods? Under what scenario(s) would you prefer to use methods based on mathematical models?\n:::\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"timer_41a2f83c\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;font-size:2em;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">02</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n# Application exercise\n\n::: appex\nüìã [AE-06: Model Conditions](https://mat212fa24.netlify.app/ae/ae-06-conditions)\n:::\n\n## Computational set up\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)   # for data wrangling and visualization\nlibrary(ggformula)   # for plotting using formulas\nlibrary(broom)       # for formatting model output\nlibrary(scales)      # for pretty axis labels\nlibrary(knitr)       # for pretty tables\nlibrary(patchwork)   # arrange plots\n\n# HEB Dataset\nheb <- read_csv(\"data/HEBIncome.csv\") |> \n  mutate(Avg_Income_K = Avg_Household_Income/1000)\n\n# set default theme and larger font size for ggplot2\nggplot2::theme_set(ggplot2::theme_bw(base_size = 20))\n```\n:::\n\n\n## Regression model, revisited\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nheb_fit <- lm(Number_Organic ~ Avg_Income_K, data = heb)\n\ntidy(heb_fit) |>\n  kable(digits = 3)\n```\n\n::: {.cell-output-display}\n\n\n|term         | estimate| std.error| statistic| p.value|\n|:------------|--------:|---------:|---------:|-------:|\n|(Intercept)  |  -14.719|     9.298|    -1.583|   0.122|\n|Avg_Income_K |    0.959|     0.128|     7.505|   0.000|\n\n\n:::\n:::\n\n\n# Model evaluation\n\n## Partitioning Variability\n\nLet's think about variation:\n\n:::{.incremental}\n- DATA = MODEL + ERROR\n- $\\substack{\\text{Variation} \\\\ \\text{in Y}} = \\substack{\\text{Variation explained} \\\\ \\text{by model}} + \\substack{\\text{Variation not explained} \\\\ \\text{by model}}$\n:::\n\n## Partitioning Variability (ANOVA)\n\n:::{.incremental}\n-   $y_i - \\bar{y} = (\\hat{y}_i - \\bar{y}) + (y_i-\\hat{y}_i)$\n-   Square and sum: $\\sum(y_i-\\bar{y})^2 = \\sum(\\hat{y} - \\bar{y})^2 + \\sum(y-\\hat{y})^2$\n-   $\\substack{\\text{Sum of squares} \\\\ \\text{Total}} = \\substack{\\text{Sum of squares} \\\\ \\text{model}} + \\substack{\\text{Sum of squares} \\\\ \\text{error}}$\n-   $SSTotal = SSModel + SSE$\n-   $SST = SSM + SSE$\n:::\n\n## ANOVA in R\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nheb_fit |> \n  anova() |> \n  tidy() |> \n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|term         | df|    sumsq|     meansq| statistic| p.value|\n|:------------|--:|--------:|----------:|---------:|-------:|\n|Avg_Income_K |  1| 17175.06| 17175.0595|  56.32026|       0|\n|Residuals    | 35| 10673.37|   304.9535|        NA|      NA|\n\n\n:::\n:::\n\n\n:::{.fragment}\n- More on this later in the semester\n:::\n\n## Recall: Correlation Coefficient\n\n-   The **correlation coefficient**, $r$, is a number between -1 and +1 that measures how strong the linear relationship between two variables $x$ and $y$ is.\n\n$$\nr = \\frac{\\sum(x_i - \\bar{x})(y_i-\\bar{y})}{\\sqrt{\\sum(x_i-\\bar{x})^2\\sum(y_i-\\bar{y})^2}}\n= \\frac{\\sum(x_i - \\bar{x})(y_i-\\bar{y})}{s_xs_y}\n$$\n\n\n## Two statistics: $R^2$ {.smaller}\n\n::: incremental\n-   **R-squared**, $R^2$, **Coefficient of Determination** : Percentage of variability in the outcome explained by the regression model (in the context of SLR, the predictor)\n$$\nR^2 = Cor(y, \\hat{y})^2\n$$\n    -  Also called **PRE (Percent Reduction in Error)** because:\n$$\nR^2 = \\frac{SSModel}{SSTotal}\n$$\n:::\n\n \n## Two statistics: RMSE {.smaller}\n\n-   **Root mean square error, RMSE**: A measure of the average error (average difference between observed and predicted values of the outcome)\n$$\nRMSE = \\sqrt{\\frac{\\sum_{i = 1}^n (y_i - \\hat{y}_i)^2}{n}}\n$$\n    + Sometimes people just case about numerator (SSE) or version without the square-root (MSE)\n    + Sometimes the denominator may have $n-1$ instead\n\n. . .\n\n::: question\nWhat indicates a good model fit? Higher or lower $R^2$? Higher or lower RMSE?\n:::\n\n## $R^2$\n\n::: incremental\n-   Ranges between 0 (terrible predictor) and 1 (perfect predictor)\n-   Has no units\n-   Calculate with `rsq()` from `yardstick` package using the augmented data:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(yardstick)\nheb_aug <- augment(heb_fit)\n\nrsq(heb_aug, truth = Number_Organic, estimate = .fitted) |> kable()\n```\n\n::: {.cell-output-display}\n\n\n|.metric |.estimator | .estimate|\n|:-------|:----------|---------:|\n|rsq     |standard   | 0.6167334|\n\n\n:::\n:::\n\n:::\n\n## Interpreting $R^2$ {.smaller}\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n::: poll\nüó≥Ô∏è **Discussion**\n\n::: midi\n::: poll\nThe $R^2$ of the model for `Number_Organic` from `Average_Income_K` is 61.7%. Which of the following is the correct interpretation of this value?\n:::\n\n1.  `Avg_Income_K` correctly predicts 61.7% of `Number_Organic` in San Antontio HEBs.\n2.  61.7% of the variability in `Number_Organic` can be explained by `Avg_Income_K`.\n3.  61.7% of the variability in `Avg_Income_K` can be explained by `Number_Organic`.\n4.  61.7% of the time `Number_Organic` can be predicted by `Avg_Income_K`.\n:::\n:::\n\n## Activity\n\n::: appex\nIn groups, at the board, design a simulation-based procedure for producing a p-value for the following hypothesis test.\n\n- $H_0: R^2 = 0$\n- $H_A: R^2 \\neq 0$\n:::\n\n## RMSE\n\n::: incremental\n-   Ranges between 0 (perfect predictor) and infinity (terrible predictor)\n\n-   Same units as the response variable\n\n-   Calculate with  `rmse()` from `yardstick` package using the augmented data:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrmse(heb_aug, truth = Number_Organic, estimate = .fitted)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 √ó 3\n  .metric .estimator .estimate\n  <chr>   <chr>          <dbl>\n1 rmse    standard        17.0\n```\n\n\n:::\n:::\n\n\n-   The value of RMSE is not very meaningful on its own, but it's useful for comparing across models (more on this and ANOVA when we get to regression with multiple predictors)\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/countdown-0.4.0/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}